! DESCRIP.: 	Resamples noisy averaged spectrum in velocity (after reduction)
! EXEC. COMM: 	> @resample_ave_spec_3sigma
! INPUTS:	---
! OUTPUTS:	---
! NOTES:	---
! AUTHOR: Marcin Gladkowski, Agata Karska
! CREATED: 20.08.2018


set def

define integer NX Xref 	! NX: the number of channels desired
						! Xref: the new reference channel 
define real vel vel_inc	! vel: the value at the reference channel
						! vel_inc: the new channel separation

file in serpens_cn10_conv

find /all


!set range -15.25 14.05 -13.25 16.05	! position offsets: west east south north
									! -----
									! Range is consistent with the HPBW and
									! the same should be used the same for 
									! other mols and srcs.
									! -----
									! HPBW: Half Power Beam Width
									! HPBW = 2460/freq (GHz) -> ["] 
									! HPBW is the biggest (~ 28") for HCN

!protostars position +- 13.9'' (0.5 of convoluted HCN 1-0 HBWM) 

!SMM1 -14.5, 13.3, -12.5, 15.3
!SMM2 149.6,177.4,-156.6,-128.8
!SMM3 131.6,159.4,-92.7,-64.9
!SMM4 92.6,120.4,-137.2,-109.4
!SMM5 13.1,40.9,63.9,91.7
!SMM6 109.1,136.9,-89.1,-61.3
!SMM9-36.85,-9.05,67.1,94.9
!SMM10 23.6,51.4,14.6,42.4
!SMM12 128.6,156.4,-140.1,-112.3
									
set match 0		! take a tolerance of search ranges (in arcsec), 0 = exact ranges
find /all		! If the tolerance is absent, the default value is 2 arcsec.

set unit v

\set weight equal	!	Weighting to be used for summations - it is needed after convolution
					!	weighting type: TIME (default), EQUAL, or SIGMA (1/sigma**2)
					!	Sigma isn't recommended unless you just made a baseline fit before
					!	Equal weight behaves differently in AVERAGE and ACCUMULATE 
					!	(which produces the sum)
average /nocheck /weight equal! for CO6-5, 13CO6-5, C18O6-5: /res


let NX 720		! For CN 1-0 is 560; HCN 1-0/H13CN 1-0 is 720;
		   		! H13CN 2-1: 370; CS 3-2: 430; C34S 3-2: 440
let XREF NX/2 	! NX/2 defines how many channels do you want at the both sides
let vel velocity
let vel_inc 0.5 ! a new sampling with 0.5 km/s

resample NX XREF vel vel_inc velocity	! RESAMPLE NX Xref Xval Xinc Unit
										! NX: the number of channels desired
										! Xref: the new reference channel 
										! Xval (vel): the value at the reference channel
										! Xinc (vel_inc): the new channel separation
										! Unit: velocity or frequency
!set mode x -80 70
set window -50 50

plot

draw window

base 0 /plot  !for C18O6-5: base 2

print area 10.0 11.9 /output smm1_hcn10_blue_comp1.txt
